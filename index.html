<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BLOCKSHOOTER</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    h1 {
      margin-top: 10px;
      font-size: 24px;
      color: #333;
    }

    p {
      color: #555;
      font-size: 16px;
    }

    canvas {
      background-color: black;
      display: block;
      margin: 10px auto;
      border: 4px solid #ccc;
      width: 100vmin;
      height: 100vmin;
    }

    #startButton {
      margin-top: 10px;
      background-color: yellow;
      color: black;
      font-size: 20px;
      font-weight: bold;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      z-index: 2;
      transition: background-color 0.3s;
      text-transform: uppercase;
    }

    #startButton:hover {
      background-color: gold;
    }

    .mobile-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    .mobile-button {
      font-size: 20px;
      padding: 12px;
      border-radius: 10px;
      background-color: #eee;
      border: 2px solid #ccc;
      cursor: pointer;
      flex: 1;
    }

    @media (min-width: 768px) {
      .mobile-controls {
        display: none;
      }
    }
  </style>
</head>
<body>

  <h1>BLOCKSHOOTER</h1>
  <p>Use Arrow Keys or Touch Controls</p>

  <canvas id="gameCanvas"></canvas>
  <button id="startButton">Click to Start</button>

  <!-- Mobile Controls -->
  <div class="mobile-controls" id="mobileControls" style="display: none;">
    <button class="mobile-button" id="leftBtn">←</button>
    <button class="mobile-button" id="shootBtn">Shoot</button>
    <button class="mobile-button" id="rightBtn">→</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvasToSquare() {
      const minSize = Math.min(window.innerWidth, window.innerHeight);
      canvas.width = minSize;
      canvas.height = minSize;
    }

    window.addEventListener('load', resizeCanvasToSquare);
    window.addEventListener('resize', resizeCanvasToSquare);

    const SCREEN_WIDTH = () => canvas.width;
    const SCREEN_HEIGHT = () => canvas.height;

    const COLORS = {
      RED: 'rgb(255,0,0)',
      GREEN: 'rgb(0,255,0)',
      BLUE: 'rgb(0,0,255)',
      YELLOW: 'rgb(255,255,0)',
      WHITE: 'rgb(255,255,255)'
    };

    const BLOCK_COLORS = [COLORS.RED, COLORS.GREEN, COLORS.BLUE, COLORS.YELLOW];

    let keys = {};
    let gameStarted = false;

    document.addEventListener('keydown', e => {
      keys[e.code] = true;
      if (e.code === 'Space') shootBlock();
    });

    document.addEventListener('keyup', e => {
      keys[e.code] = false;
    });

    // Touch control state
    let movingLeft = false;
    let movingRight = false;

    // Touch buttons
    document.getElementById('leftBtn').addEventListener('touchstart', () => movingLeft = true);
    document.getElementById('leftBtn').addEventListener('touchend', () => movingLeft = false);

    document.getElementById('rightBtn').addEventListener('touchstart', () => movingRight = true);
    document.getElementById('rightBtn').addEventListener('touchend', () => movingRight = false);

    document.getElementById('shootBtn').addEventListener('touchstart', () => shootBlock());

    const popSound = new Audio('pop.wav');

    class Shooter {
      constructor() {
        this.width = 50;
        this.height = 50;
        this.x = SCREEN_WIDTH() / 2 - this.width / 2;
        this.y = SCREEN_HEIGHT() - this.height - 10;
        this.speed = 5;
        this.color = COLORS.WHITE;
      }

      update() {
        if (keys['ArrowLeft'] || movingLeft) this.x -= this.speed;
        if (keys['ArrowRight'] || movingRight) this.x += this.speed;
        this.x = Math.max(0, Math.min(SCREEN_WIDTH() - this.width, this.x));
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    class Block {
      constructor(color, x, y, direction = 'down') {
        this.color = color;
        this.width = 40;
        this.height = 40;
        this.x = x - this.width / 2;
        this.y = y - this.height / 2;
        this.direction = direction;
        this.fallSpeed = 3;
        this.upSpeed = 5;
      }

      update() {
        if (this.direction === 'down') {
          this.y += this.fallSpeed;
        } else {
          this.y -= this.upSpeed;
        }
      }

      isOutOfScreen() {
        return (this.direction === 'down') ? this.y > SCREEN_HEIGHT() : this.y + this.height < 0;
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    let shooter = new Shooter();
    let fallingBlocks = [];
    let shotBlocks = [];
    let score = 0;
    let highScore = 0;
    let lastBlockTime = 0;
    const blockInterval = 3000;
    let lastShotTime = 0;
    const shotCooldown = 1000;
    let flashStartTime = 0;
    const flashDuration = 100;
    let isFlashing = false;

    function rectsCollide(a, b) {
      return !(a.x > b.x + b.width ||
               a.x + a.width < b.x ||
               a.y > b.y + b.height ||
               a.y + a.height < b.y);
    }

    function shootBlock() {
      const now = Date.now();
      if (now - lastShotTime < shotCooldown || !gameStarted) return;
      lastShotTime = now;

      const x = shooter.x + shooter.width / 2;
      const y = shooter.y;
      const color = BLOCK_COLORS[Math.floor(Math.random() * BLOCK_COLORS.length)];
      const block = new Block(color, x, y, 'up');
      shotBlocks.push(block);

      popSound.currentTime = 0;
      popSound.play();
    }

    function spawnBlock() {
      const x = Math.random() * (SCREEN_WIDTH() - 40) + 20;
      const y = -50;
      const color = BLOCK_COLORS[Math.floor(Math.random() * BLOCK_COLORS.length)];
      fallingBlocks.push(new Block(color, x, y, 'down'));
    }

    function update() {
      if (!gameStarted) return;

      shooter.update();

      const now = Date.now();
      if (now - lastBlockTime > blockInterval) {
        spawnBlock();
        lastBlockTime = now;
      }

      fallingBlocks = fallingBlocks.filter(block => {
        block.update();
        if (block.isOutOfScreen()) {
          score = 0;
          flashStartTime = now;
          isFlashing = true;
          return false;
        }
        return true;
      });

      shotBlocks = shotBlocks.filter(block => {
        block.update();
        return !block.isOutOfScreen();
      });

      shotBlocks.forEach((shotBlock, si) => {
        fallingBlocks.forEach((fallBlock, fi) => {
          if (rectsCollide(shotBlock, fallBlock)) {
            fallingBlocks.splice(fi, 1);
            shotBlocks.splice(si, 1);
            score++;
            if (score > highScore) highScore = score;
          }
        });
      });

      if (isFlashing && now - flashStartTime > flashDuration) {
        isFlashing = false;
      }
    }

    function draw() {
      ctx.fillStyle = isFlashing ? COLORS.RED : 'black';
      ctx.fillRect(0, 0, SCREEN_WIDTH(), SCREEN_HEIGHT());

      if (!gameStarted) {
        ctx.fillStyle = COLORS.WHITE;
        ctx.font = '48px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('BLOCKSHOOTER', SCREEN_WIDTH() / 2, SCREEN_HEIGHT() / 2 - 40);
        return;
      }

      shooter.draw();
      fallingBlocks.forEach(block => block.draw());
      shotBlocks.forEach(block => block.draw());

      ctx.fillStyle = COLORS.YELLOW;
      ctx.font = '24px Arial';
      ctx.textAlign = 'left';
      ctx.fillText(`Score: ${score}`, 20, 30);
      ctx.fillText(`High Score: ${highScore}`, SCREEN_WIDTH() - 180, 30);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    document.getElementById('startButton').addEventListener('click', () => {
      gameStarted = true;
      document.getElementById('startButton').style.display = 'none';
      document.getElementById('mobileControls').style.display = 'flex';
    });

    gameLoop();
  </script>
</body>
</html>
